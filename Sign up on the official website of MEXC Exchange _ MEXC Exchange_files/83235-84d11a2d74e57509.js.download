(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[83235],{83235:function(e,n,t){"use strict";var r=t(88901),o=t.n(r),i=t(57611),u=t(67597),c=t(72934),a=t(9891),d=t(36069),s=t(42265),l=t(61395),f=t(15129),v=t(9134),m=t.n(v),p=t(3062),b=t(81987),h=t.n(b),w=t(85372),_=t(65766),y=t(77521),x=t(872),k=t(54199),g=t.n(k);function E(e,n,t,r,o,i,u){try{var c=e[i](u),a=c.value}catch(d){return void t(d)}c.done?n(a):Promise.resolve(a).then(r,o)}function C(e){return function(){var n=this,t=arguments;return new Promise((function(r,o){var i=e.apply(n,t);function u(e){E(i,r,o,u,c,"next",e)}function c(e){E(i,r,o,u,c,"throw",e)}u(void 0)}))}}function S(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function R(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},r=Object.keys(t);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})))),r.forEach((function(n){S(e,n,t[n])}))}return e}function j(e){var n=window.sessionStorage.getItem(e)||0,t=Date.now();return Math.floor((t-n)/1e3)}var B=["REGISTER","LOGIN"],I=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,x.Wr)("User_intelligentDetectionResult",{is_success:e,fail_reason:(null===n||void 0===n?void 0:n.msg)||""})};function P(e){var n=e.t,t=e.dropdownButtonRef,r=e.isEnableVoice,o=e.sendHandle,c=e.destroy,a=(0,u.useState)({}),d=a[0],s=a[1],l=(0,u.useState)(!1),f=l[0],v=l[1],p=(0,u.useState)(!1),b=p[0],h=p[1],w=(0,u.useRef)();(0,u.useEffect)((function(){var e=function(e){!w.current.contains(e.target)&&f&&(h(!0),setTimeout((function(){c()}),300))};return document.addEventListener("click",e),function(){return document.removeEventListener("click",e)}}),[f]);var _=(0,y.throttle)((function(){var e=t.current.getBoundingClientRect(),n=w.current.getBoundingClientRect();n.width+e.left>document.body.getBoundingClientRect().width?s({top:Math.ceil(e.top+e.height),left:document.body.getBoundingClientRect().width-n.width,minWidth:e.width}):s({top:Math.ceil(e.top+e.height),left:e.left,minWidth:e.width}),v(!0)}),500);(0,u.useLayoutEffect)((function(){return _(),window.addEventListener("resize",_),function(){return window.removeEventListener("resize",_)}}),[]);var x=function(e){h(!0),setTimeout((function(){c()}),300),o(e)};return(0,i.jsxs)("div",{className:m()(g().dropdownWrapper,f&&g().dropdownShow,b&&g().dropdownHide),style:d,ref:w,children:[(0,i.jsx)("div",{className:g().dropdownItem,onClick:function(){return x()},children:n("common:mc_common_captcha_sms")}),r&&(0,i.jsx)("div",{className:g().dropdownItem,onClick:function(){return x(!0)},children:n("common:mc_common_captcha_voice")})]})}n.Z=function(e){var n=e.mobileCode,t=e.sendType,r=void 0===t?"email":t,v=e.needGeetest,b=e.geetestParams,y=void 0===b?{}:b,x=e.sendParams,k=void 0===x?{}:x,E=e.beforeSendCheck,S=e.countdownTimeLimit,T=void 0===S?60:S,N=e.autoSend,O=void 0!==N&&N,W=e.buttonType,L=void 0===W?"text":W,Z=e.buttonProps,D=void 0===Z?{}:Z,H=(0,l.Z)("common").t,V=(0,f.useRouter)().locale,F=(0,p.a)().user,M=(0,_.Z)(!0,F).userInfo,A=(0,u.useState)(!1),G=A[0],U=A[1],z=(0,u.useRef)(),Q=(0,u.useState)(0),X=Q[0],K=Q[1],Y=(0,u.useRef)(),$=(0,u.useState)(),q=$[0],J=$[1],ee=(0,u.useRef)(),ne=(0,u.useRef)(),te=function(e,n,t){var r=window._getCookie("u_id"),o=[e,n,null===t||void 0===t?void 0:t.type,null===t||void 0===t?void 0:t.mobile,null===t||void 0===t?void 0:t.email,null===t||void 0===t?void 0:t.resetPwdToken,null===t||void 0===t?void 0:t.secondAuthToken,r].filter((function(e){return void 0!==e}));return"mexc_captcha_".concat(h()(o.join("")).substring(8,24),"_timestamp")}(r,n,k),re=(0,w.ZP)(["/api/platform/country",void 0],(function(e){return(0,s.QE)(e)}),{revalidateOnFocus:!1}),oe=re.data,ie=re.error,ue=(0,u.useMemo)((function(){var e=n||(null===M||void 0===M?void 0:M.country);if(e&&oe){var t,r=null===oe||void 0===oe||null===(t=oe.data)||void 0===t?void 0:t.find((function(n){return Number(n.mobileCode)===Number(e)}));return 1===(null===r||void 0===r?void 0:r.enableVoice)}if(ie)return!1}),[n,oe,M]);(0,u.useEffect)((function(){return v&&(0,s.S2)(Y,{setData:J,onFail:B.includes(null===k||void 0===k?void 0:k.type)?function(e){return I(!1,{msg:"verification failed"})}:void 0},V,y),function(){return me()}}),[V]),(0,u.useEffect)((function(){q&&fe()}),[q]);var ce=function(){var e=j(te);e<T&&ve(T-e),O&&e>T&&ae()};(0,u.useEffect)((function(){return"mobile"===r?void 0!==ue&&ce():ce(),function(){z.current&&(clearInterval(z.current),z.current=null,K(0))}}),[F,ue]);var ae=function(){var e=C(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(!k||!k.type||X&&X>0||G||D.disabled)){e.next=2;break}return e.abrupt("return");case 2:if(e.t0="function"===typeof E,!e.t0){e.next=7;break}return e.next=6,E();case 6:e.t0=!e.sent;case 7:if(!e.t0){e.next=9;break}return e.abrupt("return");case 9:if("mobile"!==r||!ue){e.next=14;break}if(!(j(te)<300)){e.next=14;break}return pe(),e.abrupt("return");case 14:fe();case 15:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),de=(0,u.useState)(!1),se=de[0],le=de[1],fe=function(){var e=C(o().mark((function e(n){var t,i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(!k||!k.type||X&&X>0||G||D.disabled)){e.next=2;break}return e.abrupt("return");case 2:if(e.t0="function"===typeof E,!e.t0){e.next=7;break}return e.next=6,E();case 6:e.t0=!e.sent;case 7:if(!e.t0){e.next=9;break}return e.abrupt("return");case 9:if(!v){e.next=18;break}if(le(n),!q){e.next=15;break}k=R({},k,q),e.next=18;break;case 15:return null===(t=Y.current)||void 0===t||t.showCaptcha(),e.abrupt("return");case 18:if("email"!==r){e.next=24;break}return U(!0),e.next=23,(0,s.VV)(k);case 23:i=e.sent;case 24:if("mobile"!==r){e.next=35;break}if(U(!0),!(v&&se||n)){e.next=32;break}return e.next=29,(0,s.Q4)(R({},k,{country:(null===k||void 0===k?void 0:k.country)||void 0}));case 29:i=e.sent,e.next=35;break;case 32:return e.next=34,(0,s.A$)(R({},k,{country:(null===k||void 0===k?void 0:k.country)||void 0}));case 34:i=e.sent;case 35:B.includes(null===k||void 0===k?void 0:k.type)&&v&&I(!0),i&&0===i.code&&(a.ZP.success(H("mc_common_captcha_send_success"),2),window.sessionStorage.setItem(te,Date.now()),setTimeout((function(){ve()}),300)),setTimeout((function(){U(!1)}),300),v&&J(null);case 39:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),ve=function(e){var n=e||T;K(n),z.current=setInterval((function(){n<=0||(--n<=0&&(clearInterval(z.current),z.current=null),K(n))}),1e3)},me=function(){ne.current&&(document.body.removeChild(ne.current),c.unmountComponentAtNode(ne.current),ne.current=null)},pe=function(){if(!ne.current){var e=document.createElement("div");document.body.appendChild(e),ne.current=e,c.render((0,i.jsx)(P,{t:H,dropdownButtonRef:ee,isEnableVoice:ue,sendHandle:fe,destroy:me}),e)}};return(0,i.jsx)("div",{ref:ee,children:"button"===L?(0,i.jsx)(d.Z,R({style:{minWidth:88},type:"primary",ghost:!0},D,{disabled:G||D.disabled,onClick:ae,children:X?"".concat(X,"s"):H("mc_common_captcha_send")})):(0,i.jsx)("span",R({},D,{className:m()("text"===L&&g().textButton,"link"===L&&g().linkButton,(G||D.disabled)&&g().disabled,D.className),onClick:ae,children:X?"".concat(X,"s"):H("mc_common_captcha_send")}))})}},54199:function(e){e.exports={textButton:"send-verification-code_textButton__ZWEEH",disabled:"send-verification-code_disabled__gTTft",linkButton:"send-verification-code_linkButton__9FR98",dropdownWrapper:"send-verification-code_dropdownWrapper__l5OXX",dropdownShow:"send-verification-code_dropdownShow__uFeDU",dropdownHide:"send-verification-code_dropdownHide__4eUdE",dropdownItem:"send-verification-code_dropdownItem__YebrK"}}}]);