(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[26964],{67104:function(e,n,o){"use strict";o.d(n,{G:function(){return h},g:function(){return f}});var t=o(88901),r=o.n(t),i=o(57611),c=o(67597),s=o(15129),a=o(3062),d=o(43304),l=o(42265),u=o(61395),_=o(76436),m=o.n(_);function v(e,n,o,t,r,i,c){try{var s=e[i](c),a=s.value}catch(d){return void o(d)}s.done?n(a):Promise.resolve(a).then(t,r)}var f=function(e){var n=e.children,o=(0,a.a)(),t=o.user,r=o.loading,l=(0,s.useRouter)(),_=(0,u.Z)("common").t,v=l.asPath;return(0,c.useEffect)((function(){null===t&&l.push({pathname:"/login",query:{previous:encodeURIComponent(v)}})}),[t]),r?(0,i.jsx)(d.Z,{size:"gross-full-screen",className:"theme-light"}):null===t?(0,i.jsxs)("div",{className:m().wrapper,children:[(0,i.jsx)("div",{className:m().nav}),(0,i.jsx)("div",{className:m().content,children:(0,i.jsx)("div",{children:_("mc_common_auth_logined_tip_3")})})]}):(0,i.jsx)(i.Fragment,{children:n})},h=function(e){var n=e.children,o=(0,a.a)(),t=o.user,c=o.loading,s=o.refresh,_=(0,u.Z)("common").t,f=function(){var e,n=(e=r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,l.Kv)();case 2:s();case 3:case"end":return e.stop()}}),e)})),function(){var n=this,o=arguments;return new Promise((function(t,r){var i=e.apply(n,o);function c(e){v(i,t,r,c,s,"next",e)}function s(e){v(i,t,r,c,s,"throw",e)}c(void 0)}))});return function(){return n.apply(this,arguments)}}();return c?(0,i.jsx)(d.Z,{size:"gross-full-screen",className:"theme-light"}):t?(0,i.jsxs)("div",{className:m().wrapper,children:[(0,i.jsx)("div",{className:m().nav}),(0,i.jsxs)("div",{className:m().content,children:[(0,i.jsx)("div",{children:_("mc_common_auth_logined_tip_1",{account:t.account})}),(0,i.jsxs)("div",{children:[(0,i.jsx)("span",{children:_("mc_common_auth_logined_tip_2")}),(0,i.jsxs)("a",{className:m().logout,onClick:f,children:[_("mc_common_nav_quite")," \u2192"]})]})]})]}):(0,i.jsx)(i.Fragment,{children:n})}},4643:function(e,n,o){"use strict";o.d(n,{Z:function(){return E}});var t=o(57611),r=o(61395),i=o(9134),c=o.n(i),s=o(88901),a=o.n(s),d=o(67597),l=o(62049),u=o.n(l),_=o(36069),m=o(42265),v=o(65698),f=o.n(v),h=(o(43304),o(872)),p=o(15129),g=o(67385),x=o(64001),w=o(95376),j=o(68336),q=o.n(j);function y(e,n,o,t,r,i,c){try{var s=e[i](c),a=s.value}catch(d){return void o(d)}s.done?n(a):Promise.resolve(a).then(t,r)}var b=function(e,n){return e.find((function(e){return n.startsWith("/"+e)}))};var N=function(){var e=(0,r.Z)("auth").t,n=(0,p.useRouter)(),o=n.locale,i=n.query,s=n.locales,l=i.previous,v=i.redirect,j=(0,d.useState)(!1),N=j[0],k=j[1],I=(0,d.useState)(!1),C=I[0],Z=I[1],T=(0,d.useState)(),E=T[0],M=T[1],W=(0,x.Z)().data;(0,d.useEffect)((function(){console.time("qrcode-load-------------------------");var e=window.localStorage.getItem("mexc_local_fingerprint_visitorId");W?O(W):e?O({visitorId:e}):w.ZP.load().then((function(e){return e.get()})).then((function(e){e&&O(e)}))}),[]),(0,d.useEffect)((function(){W&&E&&(0,m.l7)({qrCode:E.qrCode,deviceId:W.visitorId,requestId:W.requestId}).then((function(e){null===e||void 0===e||e.code}))}),[null===W||void 0===W?void 0:W.visitorId,E]);var O=function(e){(0,m.$$)({deviceId:(null===e||void 0===e?void 0:e.visitorId)?e.visitorId:"unknowndeviceid",requestId:null===e||void 0===e?void 0:e.requestId,timeZoneOffset:(new Date).getTimezoneOffset()}).then((function(e){var n;0===(null===e||void 0===e?void 0:e.code)?(M(e.data),console.timeEnd("qrcode-load-------------------------"),setTimeout((function(){k(!0),Z(!1)}),1e3*(null===(n=e.data)||void 0===n?void 0:n.timeout))):k(!0)}))},P=function(){k(!1),Z(!1),O(W)},S=(0,d.useRef)();(0,d.useEffect)((function(){return E&&!N&&(S.current=setInterval((function(){B(E.qrCode)}),2e3)),function(){S.current&&(clearInterval(S.current),S.current=null)}}),[E,N]);var B=function(e){(0,m.jb)({qrCode:e}).then((function(e){if(0===(null===e||void 0===e?void 0:e.code)){var n=e.data;"SCAN"===(null===n||void 0===n?void 0:n.state)&&Z(!0),"CONFIRM"===(null===n||void 0===n?void 0:n.state)&&(clearInterval(S.current),S.current=null,R(n.token))}else k(!0),Z(!1)}))},R=function(){var e,t=(e=a().mark((function e(t){var r,i,c,d,u;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=8;break}return e.next=3,(0,m.h9)({ucenterToken:t});case 3:0===e.sent.code?((r=(r=l||v)?decodeURIComponent(r):"/user").startsWith("/")||(i=window.location.hostname.split(".").slice(-2).join("."),c=new URL(r),d=c.hostname||"",u=d.split(".").slice(-2).join("."),r=i===u?r:"/user"),r.startsWith("/")&&(r=(0,h.Ze)(r)?"/user":r,r=b(s,r)?r:"/".concat(o).concat(r)),setTimeout((function(){window.location.replace(r)}),2e3)):setTimeout((function(){n.push("/login")}),2e3),e.next=9;break;case 8:P();case 9:case"end":return e.stop()}}),e)})),function(){var n=this,o=arguments;return new Promise((function(t,r){var i=e.apply(n,o);function c(e){y(i,t,r,c,s,"next",e)}function s(e){y(i,t,r,c,s,"throw",e)}c(void 0)}))});return function(e){return t.apply(this,arguments)}}();return(0,t.jsxs)("div",{className:q().wrapper,children:[(0,t.jsxs)("div",{className:c()(q().qrcodeWrapper,(N||C)&&q().qrcodeWrapperDisabled),children:[E&&(0,t.jsx)("div",{className:q().qrcode,children:(0,t.jsx)(f(),{size:117,value:JSON.stringify({scheme:"qr_code_login",qrCode:E.qrCode})})}),(N||C)&&(0,t.jsx)("div",{className:q().disabledMaskContent,children:(0,t.jsxs)("div",{children:[N&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("p",{className:q().disabledMaskText,children:e("mc_login_qrcode_expired")}),(0,t.jsx)(_.Z,{className:q().disabledMaskButton,type:"primary",size:"small",onClick:P,children:e("common:mc_common_refresh")})]}),!N&&C&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:c()(q().confirmIcon,"iconfont icondone")}),(0,t.jsx)("p",{className:q().disabledMaskText,children:e("mc_login_qrcode_confirm")})]})]})})]}),(0,t.jsx)("h4",{className:q().title,children:e("mc_login_qrcode_title")}),(0,t.jsx)("p",{className:q().desc,children:(0,t.jsx)(g.Z,{i18nKey:"auth:mc_login_qrcode_desc",components:{a:(0,t.jsx)(u(),{href:"/download",children:(0,t.jsx)("a",{})})}})})]})},k=o(99108),I=o(26636),C=o(95339),Z=o(68778),T=o.n(Z);function E(e){var n=e.title,o=e.children,i=e.type,s=e.pageType,a=(0,r.Z)("auth").t,l="qrcodeLogin"===i;return(0,d.useEffect)((function(){if(window.sessionStorage.getItem("mexc_other_login_bind_info")){var e=function(){window.sessionStorage.removeItem("mexc_other_login_bind_info")};return window.addEventListener("beforeunload",e),function(){window.removeEventListener("beforeunload",e)}}}),[]),(0,t.jsx)("div",{className:T().wrapper,children:(0,t.jsxs)("div",{className:T().content,children:[(0,t.jsx)("h1",{children:n}),(0,t.jsxs)("div",{className:c()(T().body,l&&T().hasQrcodeLogin),children:[(0,t.jsx)("div",{className:T().left,children:o}),l&&(0,t.jsx)(N,{})]}),"login"===s&&(0,t.jsxs)(k.Z,{className:T().download,align:"middle",children:[(0,t.jsx)(I.Z,{children:(0,t.jsx)(C.Z,{size:62,className:T().qrcodeWrapper})}),(0,t.jsxs)(I.Z,{children:[(0,t.jsx)("h3",{className:T().downloadTitle,children:a("common:mc_common_nav_download_slogan2")}),(0,t.jsx)("h4",{className:T().downloadTitle,children:a("common:mc_common_nav_download_slogan1")}),(0,t.jsx)("p",{className:T().downloadDesc,children:a("common:mc_common_nav_download_slogan3")})]})]})]})})}},75329:function(e,n,o){"use strict";var t=o(97459),r=o.n(t);function i(e,n){for(var o=0;o<n.length;o++){var t=n[o];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}var c=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e)}var n,o,t;return n=e,o=[{key:"getRandomIv",value:function(e){return r().codec.base64.fromBits(null!==e&&void 0!==e?e:r().random.randomWords(3))}},{key:"rightPad",value:function(e,n,o){return e+Array(n-e.length+1).join(o)}},{key:"getKey",value:function(e){if(e){var n=e.length;n>32?e=e.slice(0,32):n>24&&n<32?e=e.slice(0,24):n>16&&n<24?e=e.slice(0,16):n<16&&(e=this.rightPad(e,16,"0"))}else e=this.rightPad("",32,"0");return r().codec.utf8String.toBits(e)}},{key:"encrypt",value:function(e,n){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},t=o.ts,i=void 0===t?128:t,c=o.mode,s=void 0===c?"gcm":c,a=o.iv,d={ts:i,mode:s,iv:this.getRandomIv(a)},l=r().encrypt(this.getKey(n),e,d),u=JSON.parse(l),_="".concat(u.iv).concat(u.ct);return _}},{key:"decrypt",value:function(e,n){var o=r().codec.base64.toBits(n),t={mode:"gcm",ts:128,iv:r().codec.base64.fromBits(o.slice(0,3)),ct:r().codec.base64.fromBits(o.slice(3))};return r().decrypt(this.getKey(e),JSON.stringify(t))}}],o&&i(n.prototype,o),t&&i(n,t),e}();n.Z=new c},76436:function(e){e.exports={wrapper:"auth_wrapper__1b5aI",nav:"auth_nav__TglY5",content:"auth_content__Xg9jV",logout:"auth_logout__s5itv"}},68778:function(e){e.exports={wrapper:"login_wrapper__aEuqp",content:"login_content__Rj8wX",body:"login_body__22Qvg",scale:"login_scale__usmZl",hasQrcodeLogin:"login_hasQrcodeLogin__BmCh7",left:"login_left__ZtyO_",download:"login_download__q98JE",qrcodeWrapper:"login_qrcodeWrapper__M3gBq",downloadTitle:"login_downloadTitle__h72s2",downloadDesc:"login_downloadDesc__eGCkt"}},68336:function(e){e.exports={wrapper:"qrcode-login_wrapper__agi1J",qrcodeWrapper:"qrcode-login_qrcodeWrapper__sOsyE",qrcodeWrapperDisabled:"qrcode-login_qrcodeWrapperDisabled__PGni9",qrcode:"qrcode-login_qrcode__ri_hu",disabledMaskContent:"qrcode-login_disabledMaskContent__MLOdx",disabledMaskText:"qrcode-login_disabledMaskText__CL_Di",disabledMaskButton:"qrcode-login_disabledMaskButton__d0X0d",confirmIcon:"qrcode-login_confirmIcon__Qo5Uo",title:"qrcode-login_title__dKE_y",desc:"qrcode-login_desc__kw2Ov"}}}]);